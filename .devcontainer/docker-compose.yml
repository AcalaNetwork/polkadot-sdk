version: "3.8"

services:
  devcontainer:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ../..:/workspaces:cached
      - doppler-config:/var/lib/doppler
    command: sleep infinity
    environment:
      - PW_TEST_CONNECT_WS_ENDPOINT=ws://playwright:3000
      - DOPPLER_CONFIG_DIR=/var/lib/doppler
      - DOPPLER_TOKEN=${DOPPLER_TOKEN}
    depends_on:
      - playwright
    networks:
      - veewaa-network

  playwright:
    image: mcr.microsoft.com/playwright:v1.48.2-noble
    command: /bin/sh -c "npx -y playwright@1.48.2 run-server --port 3000 --host 0.0.0.0"
    expose:
      - "3000"
    networks:
      - veewaa-network
    user: pwuser
    environment:
      - NODE_OPTIONS=--max-old-space-size=4096

networks:
  veewaa-network:
    driver: bridge

volumes:
  doppler-config:

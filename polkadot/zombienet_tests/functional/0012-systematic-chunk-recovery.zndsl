Description: Systematic chunk recovery is used if the chunk mapping feature is enabled.
Network: ./0012-systematic-chunk-recovery.toml
Creds: config

# Check authority status.
validator: reports node_roles is 10

# Ensure parachains are registered.
validator: parachain 2000 is registered within 60 seconds
validator: parachain 2001 is registered within 60 seconds

# Ensure parachains made progress and approval checking works.
validator: parachain 2000 block height is at least 15 within 400 seconds
validator: parachain 2001 block height is at least 15 within 400 seconds

validator: reports substrate_block_height{status="finalized"} is at least 30 within 400 seconds

validator: reports polkadot_parachain_approval_checking_finality_lag < 3

validator: reports polkadot_parachain_approvals_no_shows_total < 3 within 10 seconds

# Ensure we used systematic recovery
validator: log line contains "Data recovery from systematic chunks complete" within 10 seconds
validator: count of log lines containing "Data recovery from systematic chunks is not possible" is 0 within 10 seconds

# Ensure that there are no failed recoveries.
validator: reports polkadot_parachain_availability_recovery_recoveries_finished{result="failure"} is 0 within 10 seconds

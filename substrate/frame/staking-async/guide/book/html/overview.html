<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Overview - Polkadot Async Staking Guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="last-changed.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Polkadot Async Staking Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/paritytech/polkadot-sdk" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<p>This chapter paints an overview of the staking system, and its sub-components.</p>
<blockquote>
<p>Note that by any reference to "staking", we mean the <code>pallet-staking-async</code>.</p>
</blockquote>
<p>The entire system documented here is heavily biased towards Polkadot's needs, and is no longer a <em>generic</em> staking system by any means.</p>
<p>The majority of this system lives on a (system) parachain, which we refer to as <strong>AssetHub</strong> (<strong>AH</strong> for short), and a small part of it on the Polkadot relay-chain (<strong>RC</strong> for short).</p>
<p>The end goal for this system is for the staking system on AssetHub to elect a secure validator set for the relay-chain, and communicate it to the relay-chain. in a timely fashion.</p>
<p>The workings of the staking system can broadly be divided into the following components:</p>
<pre class="mermaid">flowchart LR
  subgraph RelayChain
    Session
    Historical
    Timestamp
    Authorship
  end

  subgraph AssetHub
    subgraph Staking
      AHSession[&quot;Session and Era Tracking&quot;]
      Exposures
      Slashing
      Rewards
      User[&quot;User Ledgers&quot;]

      Slashing --&gt; Exposures
      Rewards --&gt; Exposures
    end

    subgraph Election[&quot;Multi-Block Election Provider&quot;]
      Signed
      Unsigned
      Verifier
    end

    subgraph ElectionAlgorithms
      SpNpos[&quot;sp-npos-elections&quot;]
    end

    subgraph BagsList
      VoterList
    end

    Election --ElectionProvider--&gt; Staking
    Staking --ElectionDataProvider--&gt; Election
    VoterList --&gt; Staking
    Election --&gt; ElectionAlgorithms
  end

  AssetHub -- ValidatorSet --&gt; RelayChain
  RelayChain -- SessionReport+Offence --&gt; AssetHub
</pre>
<p>The following sections describe each of these components in short, with a link to a dedicated chapter.</p>
<h2 id="assethub-components"><a class="header" href="#assethub-components">AssetHub Components</a></h2>
<p>Let's first describe the components that live on the AssetHub parachain.</p>
<h3 id="user-ledgersinteractions"><a class="header" href="#user-ledgersinteractions">User Ledgers/Interactions</a></h3>
<p>This is the part of the system that allows users to <code>bond</code> tokens, <code>unbond</code> them, and declare their intentions to <code>nominate</code>, <code>validate</code>, and so on.</p>
<p>This system is fairly simple, not changed by much since the launch of the first iteration of Polkadot, and is described in detail in the <a href="./user-interactions.html">User Interface</a> chapter.</p>
<h3 id="sessions-and-eras"><a class="header" href="#sessions-and-eras">Sessions and Eras</a></h3>
<p>An era is the basic "<em>unit of time</em>" for the staking system. It is denominated in a number of smaller units called "sessions". <strong>The goal system is to elect a new validator set every era</strong>.</p>
<p>The role of this subsystem is to keep track of the session/era progress, keep track of all of the associated data, and trigger the election in due time.</p>
<p>More in <a href="./sessions-era.html">Sessions and Eras</a>.</p>
<h3 id="election-and-exposures"><a class="header" href="#election-and-exposures">Election and Exposures</a></h3>
<p>Following the above section, when the right time comes, the staking system will ask its <code>type ElectionProvider</code> to perform a new validator set to it. The process eventually completes, and is described in detail in the <a href="./election.html">Election and Exposures</a> chapter.</p>
<blockquote>
<p>To perform the election, both: <code>sp-npos-elections</code> and <code>VoterList</code> are used under the hood, which are not covered in detail here</p>
</blockquote>
<p>Worth noting is that the final outcome of the election process is what we call <code>Exposure</code>: a <code>struct</code> identifying:</p>
<ul>
<li>A validator that is now elected</li>
<li>A list of nominators who are backing the said validator</li>
</ul>
<pre><code class="language-rust noplayground">pub struct Exposure&lt;AccountId, Balance: HasCompact&gt; {
	/// The total balance backing this validator.
	#[codec(compact)]
	pub total: Balance,
	/// The validator's own stash that is exposed.
	#[codec(compact)]
	pub own: Balance,
	/// The portions of nominators stashes that are exposed.
	pub others: Vec&lt;IndividualExposure&lt;AccountId, Balance&gt;&gt;,
}</code></pre>
<p>By being in an exposure, a nominator/validator is entitled to both staking rewards, and slashing penalties, ergo they are said to be <em>exposed</em>.</p>
<h3 id="slashing-and-rewards"><a class="header" href="#slashing-and-rewards">Slashing and Rewards</a></h3>
<p>As said, these two systems work mainly on the basis of looking at the set of exposed validators and nominators. Their detailed description is in the <a href="./slashing.html">Slashing</a> and <a href="./rewards.html">Rewards</a>.</p>
<h2 id="relay-chain-components"><a class="header" href="#relay-chain-components">Relay Chain Components</a></h2>
<ul>
<li>Session, and Historical information thereof.</li>
<li>Authorship, the ability to know which validators produced blocks, among other actions worthy of being rewarded</li>
</ul>
<h2 id="cross-chain-interactions"><a class="header" href="#cross-chain-interactions">Cross Chain Interactions</a></h2>
<p>TODO</p>
<h2 id="complementary-documentation"><a class="header" href="#complementary-documentation">Complementary Documentation</a></h2>
<p>While this book gives a holistic overview of the system, we make our best effort to have each of the involved pallets also have high quality API docs. Find the latest released versions of this in docs.rs, or in the hosted version from <code>polkadot-sdk</code> master below:</p>
<ul>
<li><a href="https://paritytech.github.io/polkadot-sdk/master/pallet_staking_async/index.html"><code>pallet-staking-async</code></a></li>
<li><a href="https://paritytech.github.io/polkadot-sdk/master/pallet_election_provider_multi_block/index.html"><code>pallet-election-provider-multi-block</code></a></li>
<li><a href="https://paritytech.github.io/polkadot-sdk/master/pallet_bags_list/index.html"><code>pallet-bags-list</code></a></li>
<li><a href="https://paritytech.github.io/polkadot-sdk/master/sp_npos_elections/index.html"><code>sp-npos-elections</code></a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next prefetch" href="sessions-era.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next prefetch" href="sessions-era.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid-init.js"></script>
        <script src="mermaid.min.js"></script>


    </div>
    </body>
</html>
